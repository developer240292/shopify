{% comment %}
  Renders an article card for a given blog with settings to either show the image or not.

  Accepts:
  - blog: {Object} Blog object
  - article: {Object} Article object
  - image_height: {String} The setting changes the height of the article image, if shown
  - show_image: {String} The setting either show the article image or not. If it's not included it will show the image by default
  - show_date: {String} The setting either show the article date or not. If it's not included it will not show the image by default
  - show_author: {String} The setting either show the article author or not. If it's not included it will not show the author by default

  Usage:
  {% render 'card-article' blog: blog, article: article, show_image: section.settings.show_image %}
{% endcomment %}
<article class="card-article">
  {%- if show_image == true and article.image -%}
    {%- liquid
      assign ratio = 1
      if image_height == 'portrait'
        assign ratio = 0.8
      elsif image_height == 'adapt'
        assign ratio = article.image.aspect_ratio
      endif
      if ratio == 0 or ratio == null
        assign ratio = 1
      endif
    -%}
    <div class="post-thumb">
      <a
        href="{{ article.url }}"
        class="media-size media--{{ image_height }}"
        style="--ratio-percent: {{ 1 | divided_by: ratio | times: 100 }}%;"
      >
        <img
          srcset="{{ article.image.src | image_url }} {{ article.image.src.width }}w"
          src="{{ article.image.src | image_url: width: 533 }}"
          alt="{{ article.image.src.alt | escape }}"
          width="{{ article.image.width }}"
          height="{{ article.image.height }}"
          loading="lazy"
          class="mx-auto lazyload"
        >
      </a>
    </div>
  {%- endif -%}
  <div class="post-info">
    <h2 class="post-title">
      <a href="{{ article.url }}">{{ article.title | escape }}</a>
    </h2>
    <div class="post-meta">
      {%- if show_author -%}
        <div class="post-author">{% render 'icon-blog-author' %}&nbsp;{{ article.author -}}</div>
      {%- endif -%}
      {%- if show_date -%}
        <div class="date">
          {% render 'icon-blog-date' %}&nbsp;
          {{- article.published_at | time_tag: format: 'date' -}}
        </div>
      {%- endif -%}
      {%- if show_cmment -%}
        {%- if blog.comments_enabled? -%}
          <div class="post-comment">
            {% render 'icon-blog-comment' -%}
            <span>&nbsp;{{ article.comments_count }}</span>
          </div>
        {%- endif -%}
      {%- endif -%}
      {%- if show_tags -%}
        <div class="tags">
          {% if article.tags.size > 0 %}
            {% for tag in article.tags %}
              <a href="{{ blog.url }}/tagged/{{ tag | handle }}">{{ tag }}</a>
              {%- unless forloop.last %}
                <span class="meta-sep">,</span>
              {% endunless %}
            {% endfor %}
          {% endif %}
        </div>
      {%- endif -%}
    </div>
    {%- if show_desc -%}
      {%- if article.excerpt.size > 0 or article.content.size > 0 -%}
        <p class="post-content">
          {%- if article.excerpt.size > 0 -%}
            {{ article.excerpt | strip_html | truncatewords: 40 }}
          {%- else -%}
            {{ article.content | strip_html | truncatewords: 40 }}
          {%- endif -%}
        </p>
      {%- endif -%}
    {%- endif -%}
  </div>
</article>
