{% comment %}
  Renders shop-sort (sorting)
  Accepts:
  - results: {Object} Collection or Search object
  Usage:
  {% render 'shop-sort', results: collection %}
{% endcomment %}

{%- liquid
  assign sort_by = results.sort_by | default: results.default_sort_by
  if results.url
    assign results_url = results.url
  else
    assign terms = results.terms | escape
    assign results_url = '?q=' | append: terms | append: '&options%5Bprefix%5D=last&sort_by=' | append: sort_by
  endif
-%}
<facet-filters-form class="facets facets-sort no-js-hidden">
  <form class="facets-form" id="FacetSortForm">
    <div class="facet-filters sorting">
      <div class="facet-filters__field">
        <h2 class="facet-filters__label">
          <label for="SortByCategory">{{ 'products.facets.sort_by_label' | t }}</label>
        </h2>
        <div class="select">
          {%- assign sort_by = results.sort_by | default: results.default_sort_by -%}
          <select
            name="sort_by"
            class="facet-filters__sort select__select"
            id="SortByCategory"
            aria-describedby="a11y-refresh-page-message"
          >
            {%- for option in results.sort_options -%}
              <option
                value="{{ option.value | escape }}"
                {% if option.value == sort_by %}
                  selected="selected"
                {% endif %}
              >
                {{ option.name | escape }}
              </option>
            {%- endfor -%}
          </select>
        </div>
      </div>
      <noscript>
        <button type="submit" class="facets__button-no-js button">
          {{ 'products.facets.sort_button' | t }}
        </button>
      </noscript>
    </div>
    <div class="product-count-vertical" role="status">
      <h2 class="product-count__text">
        <span id="ProductCountDesktop">
          {%- if results.results_count -%}
            {{ 'templates.search.results_with_count' | t: terms: results.terms, count: results.results_count }}
          {%- elsif results.products_count == results.all_products_count -%}
            {{ 'products.facets.product_count_simple' | t: count: results.products_count }}
          {%- else -%}
            {{
              'products.facets.product_count'
              | t: product_count: results.products_count, count: results.all_products_count
            }}
          {%- endif -%}
        </span>
      </h2>
      <div class="loading-overlay__spinner">
        <svg
          aria-hidden="true"
          focusable="false"
          role="presentation"
          class="spinner"
          viewBox="0 0 66 66"
          xmlns="http://www.w3.org/2000/svg"
        >
          <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
        </svg>
      </div>
    </div>
  </form>
</facet-filters-form>
